<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <title>Airplane Design Process</title>
  <link href="https://playground.anychart.com/gallery/Pert_Charts/Airplane_Design_Process/iframe" rel="canonical">

    <!-- Custom fonts for this page-->
    <link href="../../assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

    <!-- Page level plugin CSS-->
    <link href="../../assets/vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">

    <!-- Custom styles for this page-->
    <link href="../../assets/vendor/anychart.js/anychart-ui.min.css" rel="stylesheet" type="text/css">
    <link href="../../assets/vendor/anychart.js/anychart-font.min.css" rel="stylesheet" type="text/css">
    <link href="../../assets/vendor/semantic-ui/semantic.css" rel="stylesheet">
    <link href="../../assets/css/sb-admin-2.css" rel="stylesheet">
    <link href="../../assets/css/dashboard.css" rel="stylesheet">


  <meta content="PERT Chart,Project Management,Tooltip" name="keywords">
  <meta content="AnyChart - JavaScript Charts designed to be embedded and integrated" name="description">
  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  <link href="../../assets/vendor/anychart.js/anychart-ui.min.css" rel="stylesheet" type="text/css">
  <link href="../../assets/vendor/anychart.js/anychart-font.min.css" rel="stylesheet" type="text/css">
  <style>html, body, #container {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
}
.test{
    height: 100%;
}
</style>
 </head>
 <body>
    <div id="wrapper" class="test"> 
        
        <div id="content-wrapper" >
            
            <!-- Main Content -->
             <div id="content" class="test">
                 
                    
                <!-- Begin Page Content -->
                <div class="container-fluid test" >
                        
                    <div class="row test">
                        
                        <div class="col-xl-12 test">
                            
                            <div class="card shadow-xlg test">
                                
                                <div id="container"></div>

                                <div class="card-body test">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
             </div>

        </div>
    </div>


  <!-- Bootstrap core JavaScript-->
  <script src="../../assets/vendor/jquery/jquery.min.js"></script>
  <script src="../../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../../assets/vendor/datatables/jquery.dataTables.js"></script>
  <script src="../../assets/vendor/datatables/dataTables.bootstrap4.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="../../assets/vendor/jquery-easing/jquery.easing.min.js"></script>
  <script src="../../assets/vendor/chart.js/Chart.min.js"></script>

  <!-- Custom scripts for all pages-->
  <script src="../../assets/js/sb-admin-2.js"></script>
  <script src="../../assets/js/logout.js"></script>
  <script src="../../assets/js/get-username.js"></script>

  <!-- Scripts for this dashboard -->
  <script src="../../assets/js/global-variables.js"></script>
  <script src="../../assets/vendor/anychart.js/anychart-base.min.js"></script>
  <script src="../../assets/vendor/anychart.js/anychart-ui.min.js"></script>
  <script src="../../assets/vendor/anychart.js/anychart-exports.min.js"></script>
  <script src="../../assets/vendor/anychart.js/anychart-pert.min.js"></script>
  <script src="js/smart-reporting.js"></script>
  <script type="text/javascript">anychart.onDocumentReady(function () {
      //Urls
    var urlGetAllTasks = urlMain + 'api/GetTasksPerProject/33';
    var data;
    var pert_array = new Array();
    var pert_object = {
        'id': "",
        'duration': "",
        'name': "",
        'dependsOn': "",
        'fullName': "",
    };

    //Fetch User Details
    fetch(urlGetAllTasks, {
        async: false,
        method: 'GET',
        crossDomain: true,
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
        }
    }).then(function (a) { return a.json() })
    .then(function (j) {

    for(var i = 0; i < j.length; i++){
        if(j[i].PredecessorTaskID == 0){
            pert_array.push({
                'id': ''+j[i].TaskID+'',
                'duration': j[i].Number_of_days,
                'name': ''+j[i].TaskID+'',
                'fullName': j[i].Name,
            })

        }else{
            var array = [""+j[i].PredecessorTaskID+""];

            pert_array.push({
                'id': ''+j[i].TaskID+'',
                'duration': j[i].Number_of_days,
                'name': ''+j[i].TaskID+'',
                'dependsOn': array,
                'fullName': j[i].Name,
            })

        }
        
    }

    // data
     data = pert_array;
    console.log(pert_array);

    // set filling method for tree
    var treeData = anychart.data.tree(data, 'as-table');

    // create PERT chart
    var chart = anychart.pert();
    // set spacing between milestones
    chart.data(treeData)
            .horizontalSpacing('18.7%')
            // set padding for chart
            .padding([25, 50, -40, 50]);

    // get duration project
    var duration = chart.getStat('pertChartProjectDuration');

    // set title text
    chart.title()
            .enabled(true)
            .useHtml(true)
            .padding([0, 0, 35, 0])
            .text(
                    "Airplane Design Process with PERT Chart" +
                    "<br>" + "Project duration: " +
                    duration + ' days'
            );

    // set settings for tasks
    var tasks = chart.tasks();
    // format upper label task
    tasks.upperLabels().format(function () {
        return this.item.get('fullName');
    });

    // format lower label task
    tasks.lowerLabels().format('{%duration} days');

    // create tasks tooltip
    var taskTooltip = tasks.tooltip();
    // tooltip settings
    taskTooltip.separator(true)
            .titleFormat(function () {
                // return fullName from data
                return this.item.get('fullName');
            });
    taskTooltip.title().useHtml(true);

    // set settings for milestones
    var milestones = chart.milestones();
    // set milestones color
    milestones.color('#2C81D5')
            // set milestones item size
            .size('5%');
    milestones.hovered().fill(function () {
        return anychart.color.lighten(this.sourceColor, 0.25);
    });
    milestones.tooltip().format(defuaultMilesoneTooltipTextFormatter);

    // set settings for critical milestones
    var critMilestones = chart.criticalPath().milestones();
    // format label
    critMilestones.labels().format(function () {
        return this['creator'] ? this['creator'].get('name') : this['isStart'] ? 'Start' : 'Finish';
    });
    // set color
    critMilestones.color('#E24B26')
            // fill color for critMilestones item
            .fill(function () {
                return this['creator'] ? this.sourceColor : this['isStart'] ? '#60727B' : '#60727B';
            });

    // hover fill/stroke color for critMilestones item
    critMilestones.hovered()
            .fill(function () {
                return this['creator'] ? anychart.color.lighten(this.sourceColor, 0.25) : this['isStart'] ? '#60727b' : '#60727b';
            })
            .stroke(function () {
                return this['creator'] ? '1.5 #a94e3d' : null;
            });

    // set container id for the chart
    chart.container('container');
    // initiate chart drawing
    chart.draw();

}).catch(error => console.error('Error:', error));
});

function defuaultMilesoneTooltipTextFormatter() {
    var result = '';
    var i = 0;
    if (this['successors'] && this['successors'].length) {
        result += 'Successors:';
        for (i = 0; i < this['successors'].length; i++) {
            result += '\n - ' + this['successors'][i].get('fullName');
        }
        if (this['predecessors'] && this['predecessors'].length)
            result += '\n\n';
    }
    if (this['predecessors'] && this['predecessors'].length) {
        result += 'Predecessors:';
        for (i = 0; i < this['predecessors'].length; i++) {
            result += '\n - ' + this['predecessors'][i].get('fullName');
        }
    }
    return result;
}
</script>
 </body>
</html>